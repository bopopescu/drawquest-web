import base64

from drawquest.tests.tests_helpers import (CanvasTestCase, create_content, create_user, create_group,
                                           create_comment, create_staff, create_quest, create_quest_comment)
from drawquest import economy
from services import Services, override_service


#class TestIap(CanvasTestCase):
#    def test_purchasing_coins(self):
#        user = create_user()
#        data = 'ewoJInNpZ25hdHVyZSIgPSAiQWdKd2tNVzQrNTh6cGpNUG9Ga1NxamtyM0p1R0tk\r\nczVJVGIvYlhzeUd2MXZ0MndYQWl6N3htQmFUYVVua2RRM25oM2dBdFM2TnFnWjFS\r\nbUVWbEhkQW01N2pEQ1FYQk1Uc0ZUeFA3cDFlbnBrUXR3cUxGTHdDajZmbEowTXEw\r\ndFRIRUtnOGlKa0ptSmFtQjRjLy9xZ1VFanJWQ2Nid0ZwOXZneHdYYWo5WDVaeEFB\r\nQURWekNDQTFNd2dnSTdvQU1DQVFJQ0NHVVVrVTNaV0FTMU1BMEdDU3FHU0liM0RR\r\nRUJCUVVBTUg4eEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUtEQXBCY0hCc1pT\r\nQkpibU11TVNZd0pBWURWUVFMREIxQmNIQnNaU0JEWlhKMGFXWnBZMkYwYVc5dUlF\r\nRjFkR2h2Y21sMGVURXpNREVHQTFVRUF3d3FRWEJ3YkdVZ2FWUjFibVZ6SUZOMGIz\r\nSmxJRU5sY25ScFptbGpZWFJwYjI0Z1FYVjBhRzl5YVhSNU1CNFhEVEE1TURZeE5U\r\nSXlNRFUxTmxvWERURTBNRFl4TkRJeU1EVTFObG93WkRFak1DRUdBMVVFQXd3YVVI\r\nVnlZMmhoYzJWU1pXTmxhWEIwUTJWeWRHbG1hV05oZEdVeEd6QVpCZ05WQkFzTUVr\r\nRndjR3hsSUdsVWRXNWxjeUJUZEc5eVpURVRNQkVHQTFVRUNnd0tRWEJ3YkdVZ1NX\r\nNWpMakVMTUFrR0ExVUVCaE1DVlZNd2daOHdEUVlKS29aSWh2Y05BUUVCQlFBRGdZ\r\nMEFNSUdKQW9HQkFNclJqRjJjdDRJclNkaVRDaGFJMGc4cHd2L2NtSHM4cC9Sd1Yv\r\ncnQvOTFYS1ZoTmw0WElCaW1LalFRTmZnSHNEczZ5anUrK0RyS0pFN3VLc3BoTWRk\r\nS1lmRkU1ckdYc0FkQkVqQndSSXhleFRldngzSExFRkdBdDFtb0t4NTA5ZGh4dGlJ\r\nZERnSnYyWWFWczQ5QjB1SnZOZHk2U01xTk5MSHNETHpEUzlvWkhBZ01CQUFHamNq\r\nQndNQXdHQTFVZEV3RUIvd1FDTUFBd0h3WURWUjBqQkJnd0ZvQVVOaDNvNHAyQzBn\r\nRVl0VEpyRHRkREM1RllRem93RGdZRFZSMFBBUUgvQkFRREFnZUFNQjBHQTFVZERn\r\nUVdCQlNwZzRQeUdVakZQaEpYQ0JUTXphTittVjhrOVRBUUJnb3Foa2lHOTJOa0Jn\r\nVUJCQUlGQURBTkJna3Foa2lHOXcwQkFRVUZBQU9DQVFFQUVhU2JQanRtTjRDL0lC\r\nM1FFcEszMlJ4YWNDRFhkVlhBZVZSZVM1RmFaeGMrdDg4cFFQOTNCaUF4dmRXLzNl\r\nVFNNR1k1RmJlQVlMM2V0cVA1Z204d3JGb2pYMGlreVZSU3RRKy9BUTBLRWp0cUIw\r\nN2tMczlRVWU4Y3pSOFVHZmRNMUV1bVYvVWd2RGQ0TndOWXhMUU1nNFdUUWZna1FR\r\nVnk4R1had1ZIZ2JFL1VDNlk3MDUzcEdYQms1MU5QTTN3b3hoZDNnU1JMdlhqK2xv\r\nSHNTdGNURXFlOXBCRHBtRzUrc2s0dHcrR0szR01lRU41LytlMVFUOW5wL0tsMW5q\r\nK2FCdzdDMHhzeTBiRm5hQWQxY1NTNnhkb3J5L0NVdk02Z3RLc21uT09kcVRlc2Jw\r\nMGJzOHNuNldxczBDOWRnY3hSSHVPTVoydG04bnBMVW03YXJnT1N6UT09IjsKCSJw\r\ndXJjaGFzZS1pbmZvIiA9ICJld29KSW05eWFXZHBibUZzTFhCMWNtTm9ZWE5sTFdS\r\naGRHVXRjSE4wSWlBOUlDSXlNREV5TFRFeExUQTVJREExT2pVM09qTTNJRUZ0WlhK\r\ncFkyRXZURzl6WDBGdVoyVnNaWE1pT3dvSkluVnVhWEYxWlMxcFpHVnVkR2xtYVdW\r\neUlpQTlJQ0l3TURBd1lqQXdPVEk0TVRnaU93b0pJbTl5YVdkcGJtRnNMWFJ5WVc1\r\nellXTjBhVzl1TFdsa0lpQTlJQ0l4TURBd01EQXdNRFU0TXpZMU16SXlJanNLQ1NK\r\naWRuSnpJaUE5SUNJeExqQWlPd29KSW5SeVlXNXpZV04wYVc5dUxXbGtJaUE5SUNJ\r\neE1EQXdNREF3TURVNE16WTFNekl5SWpzS0NTSnhkV0Z1ZEdsMGVTSWdQU0FpTVNJ\r\nN0Nna2liM0pwWjJsdVlXd3RjSFZ5WTJoaGMyVXRaR0YwWlMxdGN5SWdQU0FpTVRN\r\nMU1qUTJPVFExTnpRMk9DSTdDZ2tpY0hKdlpIVmpkQzFwWkNJZ1BTQWlZWE11WTJG\r\ndWRpNWtjbUYzY1hWbGMzUXVjSEp2WkhWamRITXVZMjlwYm5NdU1UQXdJanNLQ1NK\r\ncGRHVnRMV2xrSWlBOUlDSTFOelk1TWpFeU1ESWlPd29KSW1KcFpDSWdQU0FpWVhN\r\ndVkyRnVkaTVrY21GM2NYVmxjM1FpT3dvSkluQjFjbU5vWVhObExXUmhkR1V0YlhN\r\naUlEMGdJakV6TlRJME5qazBOVGMwTmpnaU93b0pJbkIxY21Ob1lYTmxMV1JoZEdV\r\naUlEMGdJakl3TVRJdE1URXRNRGtnTVRNNk5UYzZNemNnUlhSakwwZE5WQ0k3Q2dr\r\naWNIVnlZMmhoYzJVdFpHRjBaUzF3YzNRaUlEMGdJakl3TVRJdE1URXRNRGtnTURV\r\nNk5UYzZNemNnUVcxbGNtbGpZUzlNYjNOZlFXNW5aV3hsY3lJN0Nna2liM0pwWjJs\r\ndVlXd3RjSFZ5WTJoaGMyVXRaR0YwWlNJZ1BTQWlNakF4TWkweE1TMHdPU0F4TXpv\r\nMU56b3pOeUJGZEdNdlIwMVVJanNLZlE9PSI7CgkiZW52aXJvbm1lbnQiID0gIlNh\r\nbmRib3giOwoJInBvZCIgPSAiMTAwIjsKCSJzaWduaW5nLXN0YXR1cyIgPSAiMCI7\r\nCn0=' 

#        #data = 'ewoJInNpZ25hdHVyZSIgPSAiQWdvL29UYUE4YjhocHorMVVmZ1hDYlFnRDM2U3dN\r\nd05EVi9SN3hCUzQvUm0xbVB3TWE3bGNjMFVnZ1llaTRNTEJQa003YStzcklhaThn\r\nQzJkR0psdHJidUw1NlRQYTFNQWllRzNrMitoVXd4SDQ5ckE5K2FCMzA1aCtkRHVu\r\nVFRKTWRmUVozcjB0emM5enZzZ0ZvL3NVeU9yTGFwWFFEVGh6S2JramtmbDQ3K0FB\r\nQURWekNDQTFNd2dnSTdvQU1DQVFJQ0NHVVVrVTNaV0FTMU1BMEdDU3FHU0liM0RR\r\nRUJCUVVBTUg4eEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUtEQXBCY0hCc1pT\r\nQkpibU11TVNZd0pBWURWUVFMREIxQmNIQnNaU0JEWlhKMGFXWnBZMkYwYVc5dUlF\r\nRjFkR2h2Y21sMGVURXpNREVHQTFVRUF3d3FRWEJ3YkdVZ2FWUjFibVZ6SUZOMGIz\r\nSmxJRU5sY25ScFptbGpZWFJwYjI0Z1FYVjBhRzl5YVhSNU1CNFhEVEE1TURZeE5U\r\nSXlNRFUxTmxvWERURTBNRFl4TkRJeU1EVTFObG93WkRFak1DRUdBMVVFQXd3YVVI\r\nVnlZMmhoYzJWU1pXTmxhWEIwUTJWeWRHbG1hV05oZEdVeEd6QVpCZ05WQkFzTUVr\r\nRndjR3hsSUdsVWRXNWxjeUJUZEc5eVpURVRNQkVHQTFVRUNnd0tRWEJ3YkdVZ1NX\r\nNWpMakVMTUFrR0ExVUVCaE1DVlZNd2daOHdEUVlKS29aSWh2Y05BUUVCQlFBRGdZ\r\nMEFNSUdKQW9HQkFNclJqRjJjdDRJclNkaVRDaGFJMGc4cHd2L2NtSHM4cC9Sd1Yv\r\ncnQvOTFYS1ZoTmw0WElCaW1LalFRTmZnSHNEczZ5anUrK0RyS0pFN3VLc3BoTWRk\r\nS1lmRkU1ckdYc0FkQkVqQndSSXhleFRldngzSExFRkdBdDFtb0t4NTA5ZGh4dGlJ\r\nZERnSnYyWWFWczQ5QjB1SnZOZHk2U01xTk5MSHNETHpEUzlvWkhBZ01CQUFHamNq\r\nQndNQXdHQTFVZEV3RUIvd1FDTUFBd0h3WURWUjBqQkJnd0ZvQVVOaDNvNHAyQzBn\r\nRVl0VEpyRHRkREM1RllRem93RGdZRFZSMFBBUUgvQkFRREFnZUFNQjBHQTFVZERn\r\nUVdCQlNwZzRQeUdVakZQaEpYQ0JUTXphTittVjhrOVRBUUJnb3Foa2lHOTJOa0Jn\r\nVUJCQUlGQURBTkJna3Foa2lHOXcwQkFRVUZBQU9DQVFFQUVhU2JQanRtTjRDL0lC\r\nM1FFcEszMlJ4YWNDRFhkVlhBZVZSZVM1RmFaeGMrdDg4cFFQOTNCaUF4dmRXLzNl\r\nVFNNR1k1RmJlQVlMM2V0cVA1Z204d3JGb2pYMGlreVZSU3RRKy9BUTBLRWp0cUIw\r\nN2tMczlRVWU4Y3pSOFVHZmRNMUV1bVYvVWd2RGQ0TndOWXhMUU1nNFdUUWZna1FR\r\nVnk4R1had1ZIZ2JFL1VDNlk3MDUzcEdYQms1MU5QTTN3b3hoZDNnU1JMdlhqK2xv\r\nSHNTdGNURXFlOXBCRHBtRzUrc2s0dHcrR0szR01lRU41LytlMVFUOW5wL0tsMW5q\r\nK2FCdzdDMHhzeTBiRm5hQWQxY1NTNnhkb3J5L0NVdk02Z3RLc21uT09kcVRlc2Jw\r\nMGJzOHNuNldxczBDOWRnY3hSSHVPTVoydG04bnBMVW03YXJnT1N6UT09IjsKCSJw\r\ndXJjaGFzZS1pbmZvIiA9ICJld29KSW05eWFXZHBibUZzTFhCMWNtTm9ZWE5sTFdS\r\naGRHVXRjSE4wSWlBOUlDSXlNREV6TFRBeExURXdJREUyT2pBNE9qSTJJRUZ0WlhK\r\ncFkyRXZURzl6WDBGdVoyVnNaWE1pT3dvSkluQjFjbU5vWVhObExXUmhkR1V0YlhN\r\naUlEMGdJakV6TlRjNE5qSTVNRFk1T1RjaU93b0pJblZ1YVhGMVpTMXBaR1Z1ZEds\r\nbWFXVnlJaUE5SUNJM01ESTJZVGM1TXpjNVptUmtZakZqTmpjNU1XRm1OVE13TW1F\r\nMlpUVTFNbVU0TnpCaVlqY3hJanNLQ1NKdmNtbG5hVzVoYkMxMGNtRnVjMkZqZEds\r\ndmJpMXBaQ0lnUFNBaU1qTXdNREF3TURJME5qQTJPRFEzSWpzS0NTSmlkbkp6SWlB\r\nOUlDSXhMakFpT3dvSkltRndjQzFwZEdWdExXbGtJaUE5SUNJMU56WTVNVGMwTWpV\r\naU93b0pJblJ5WVc1ellXTjBhVzl1TFdsa0lpQTlJQ0l5TXpBd01EQXdNalEyTURZ\r\nNE5EY2lPd29KSW5GMVlXNTBhWFI1SWlBOUlDSXhJanNLQ1NKdmNtbG5hVzVoYkMx\r\nd2RYSmphR0Z6WlMxa1lYUmxMVzF6SWlBOUlDSXhNelUzT0RZeU9UQTJPVGszSWpz\r\nS0NTSjFibWx4ZFdVdGRtVnVaRzl5TFdsa1pXNTBhV1pwWlhJaUlEMGdJalJHTWtK\r\nRFEwWXhMVGhGTVRjdE5EYzVNQzFDUTBNNUxVUkdNRVkzTURjME1EZEVNU0k3Q2dr\r\naWFYUmxiUzFwWkNJZ1BTQWlOVGMyT1RJeE1qQXlJanNLQ1NKMlpYSnphVzl1TFdW\r\nNGRHVnlibUZzTFdsa1pXNTBhV1pwWlhJaUlEMGdJakV4T1RBek1UUTBJanNLQ1NK\r\nd2NtOWtkV04wTFdsa0lpQTlJQ0poY3k1allXNTJMbVJ5WVhkeGRXVnpkQzV3Y205\r\na2RXTjBjeTVqYjJsdWN5NHhNREFpT3dvSkluQjFjbU5vWVhObExXUmhkR1VpSUQw\r\nZ0lqSXdNVE10TURFdE1URWdNREE2TURnNk1qWWdSWFJqTDBkTlZDSTdDZ2tpYjNK\r\ncFoybHVZV3d0Y0hWeVkyaGhjMlV0WkdGMFpTSWdQU0FpTWpBeE15MHdNUzB4TVNB\r\nd01Eb3dPRG95TmlCRmRHTXZSMDFVSWpzS0NTSmlhV1FpSUQwZ0ltRnpMbU5oYm5Z\r\ndVpISmhkM0YxWlhOMElqc0tDU0p3ZFhKamFHRnpaUzFrWVhSbExYQnpkQ0lnUFNB\r\naU1qQXhNeTB3TVMweE1DQXhOam93T0RveU5pQkJiV1Z5YVdOaEwweHZjMTlCYm1k\r\nbGJHVnpJanNLZlE9PSI7CgkicG9kIiA9ICIyMyI7Cgkic2lnbmluZy1zdGF0dXMi\r\nID0gIjAiOwp9'
#        #data = 'ewoJInNpZ25hdHVyZSIgPSAiQWdvL29UYUE4YjhocHorMVVmZ1hDYlFnRDM2U3dNd05EVi9SN3hCUzQvUm0xbVB3TWE3bGNjMFVnZ1llaTRNTEJQa003YStzcklhaThnQzJkR0psdHJidUw1NlRQYTFNQWllRzNrMitoVXd4SDQ5ckE5K2FCMzA1aCtkRHVuVFRKTWRmUVozcjB0emM5enZzZ0ZvL3NVeU9yTGFwWFFEVGh6S2JramtmbDQ3K0FBQURWekNDQTFNd2dnSTdvQU1DQVFJQ0NHVVVrVTNaV0FTMU1BMEdDU3FHU0liM0RRRUJCUVVBTUg4eEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUtEQXBCY0hCc1pTQkpibU11TVNZd0pBWURWUVFMREIxQmNIQnNaU0JEWlhKMGFXWnBZMkYwYVc5dUlFRjFkR2h2Y21sMGVURXpNREVHQTFVRUF3d3FRWEJ3YkdVZ2FWUjFibVZ6SUZOMGIzSmxJRU5sY25ScFptbGpZWFJwYjI0Z1FYVjBhRzl5YVhSNU1CNFhEVEE1TURZeE5USXlNRFUxTmxvWERURTBNRFl4TkRJeU1EVTFObG93WkRFak1DRUdBMVVFQXd3YVVIVnlZMmhoYzJWU1pXTmxhWEIwUTJWeWRHbG1hV05oZEdVeEd6QVpCZ05WQkFzTUVrRndjR3hsSUdsVWRXNWxjeUJUZEc5eVpURVRNQkVHQTFVRUNnd0tRWEJ3YkdVZ1NXNWpMakVMTUFrR0ExVUVCaE1DVlZNd2daOHdEUVlKS29aSWh2Y05BUUVCQlFBRGdZMEFNSUdKQW9HQkFNclJqRjJjdDRJclNkaVRDaGFJMGc4cHd2L2NtSHM4cC9Sd1YvcnQvOTFYS1ZoTmw0WElCaW1LalFRTmZnSHNEczZ5anUrK0RyS0pFN3VLc3BoTWRkS1lmRkU1ckdYc0FkQkVqQndSSXhleFRldngzSExFRkdBdDFtb0t4NTA5ZGh4dGlJZERnSnYyWWFWczQ5QjB1SnZOZHk2U01xTk5MSHNETHpEUzlvWkhBZ01CQUFHamNqQndNQXdHQTFVZEV3RUIvd1FDTUFBd0h3WURWUjBqQkJnd0ZvQVVOaDNvNHAyQzBnRVl0VEpyRHRkREM1RllRem93RGdZRFZSMFBBUUgvQkFRREFnZUFNQjBHQTFVZERnUVdCQlNwZzRQeUdVakZQaEpYQ0JUTXphTittVjhrOVRBUUJnb3Foa2lHOTJOa0JnVUJCQUlGQURBTkJna3Foa2lHOXcwQkFRVUZBQU9DQVFFQUVhU2JQanRtTjRDL0lCM1FFcEszMlJ4YWNDRFhkVlhBZVZSZVM1RmFaeGMrdDg4cFFQOTNCaUF4dmRXLzNlVFNNR1k1RmJlQVlMM2V0cVA1Z204d3JGb2pYMGlreVZSU3RRKy9BUTBLRWp0cUIwN2tMczlRVWU4Y3pSOFVHZmRNMUV1bVYvVWd2RGQ0TndOWXhMUU1nNFdUUWZna1FRVnk4R1had1ZIZ2JFL1VDNlk3MDUzcEdYQms1MU5QTTN3b3hoZDNnU1JMdlhqK2xvSHNTdGNURXFlOXBCRHBtRzUrc2s0dHcrR0szR01lRU41LytlMVFUOW5wL0tsMW5qK2FCdzdDMHhzeTBiRm5hQWQxY1NTNnhkb3J5L0NVdk02Z3RLc21uT09kcVRlc2JwMGJzOHNuNldxczBDOWRnY3hSSHVPTVoydG04bnBMVW03YXJnT1N6UT09IjsKCSJwdXJjaGFzZS1pbmZvIiA9ICJld29KSW05eWFXZHBibUZzTFhCMWNtTm9ZWE5sTFdSaGRHVXRjSE4wSWlBOUlDSXlNREV6TFRBeExURXdJREUyT2pBNE9qSTJJRUZ0WlhKcFkyRXZURzl6WDBGdVoyVnNaWE1pT3dvSkluQjFjbU5vWVhObExXUmhkR1V0YlhNaUlEMGdJakV6TlRjNE5qSTVNRFk1T1RjaU93b0pJblZ1YVhGMVpTMXBaR1Z1ZEdsbWFXVnlJaUE5SUNJM01ESTJZVGM1TXpjNVptUmtZakZqTmpjNU1XRm1OVE13TW1FMlpUVTFNbVU0TnpCaVlqY3hJanNLQ1NKdmNtbG5hVzVoYkMxMGNtRnVjMkZqZEdsdmJpMXBaQ0lnUFNBaU1qTXdNREF3TURJME5qQTJPRFEzSWpzS0NTSmlkbkp6SWlBOUlDSXhMakFpT3dvSkltRndjQzFwZEdWdExXbGtJaUE5SUNJMU56WTVNVGMwTWpVaU93b0pJblJ5WVc1ellXTjBhVzl1TFdsa0lpQTlJQ0l5TXpBd01EQXdNalEyTURZNE5EY2lPd29KSW5GMVlXNTBhWFI1SWlBOUlDSXhJanNLQ1NKdmNtbG5hVzVoYkMxd2RYSmphR0Z6WlMxa1lYUmxMVzF6SWlBOUlDSXhNelUzT0RZeU9UQTJPVGszSWpzS0NTSjFibWx4ZFdVdGRtVnVaRzl5TFdsa1pXNTBhV1pwWlhJaUlEMGdJalJHTWtKRFEwWXhMVGhGTVRjdE5EYzVNQzFDUTBNNUxVUkdNRVkzTURjME1EZEVNU0k3Q2draWFYUmxiUzFwWkNJZ1BTQWlOVGMyT1RJeE1qQXlJanNLQ1NKMlpYSnphVzl1TFdWNGRHVnlibUZzTFdsa1pXNTBhV1pwWlhJaUlEMGdJakV4T1RBek1UUTBJanNLQ1NKd2NtOWtkV04wTFdsa0lpQTlJQ0poY3k1allXNTJMbVJ5WVhkeGRXVnpkQzV3Y205a2RXTjBjeTVqYjJsdWN5NHhNREFpT3dvSkluQjFjbU5vWVhObExXUmhkR1VpSUQwZ0lqSXdNVE10TURFdE1URWdNREE2TURnNk1qWWdSWFJqTDBkTlZDSTdDZ2tpYjNKcFoybHVZV3d0Y0hWeVkyaGhjMlV0WkdGMFpTSWdQU0FpTWpBeE15MHdNUzB4TVNBd01Eb3dPRG95TmlCRmRHTXZSMDFVSWpzS0NTSmlhV1FpSUQwZ0ltRnpMbU5oYm5ZdVpISmhkM0YxWlhOMElqc0tDU0p3ZFhKamFHRnpaUzFrWVhSbExYQnpkQ0lnUFNBaU1qQXhNeTB3TVMweE1DQXhOam93T0RveU5pQkJiV1Z5YVdOaEwweHZjMTlCYm1kbGJHVnpJanNLZlE9PSI7CgkicG9kIiA9ICIyMyI7Cgkic2lnbmluZy1zdGF0dXMiID0gIjAiOwp9'

#        def balance():
#            return self.api_post('/api/economy/balance', user=user)['balance']

#        old_balance = balance()

#        resp = self.api_post('/api/iap/process_receipt', {'receipt_data': data}, user=user)
#        self.assertAPISuccess(resp)
#        self.assertEqual(balance() - old_balance, resp['balance'])

